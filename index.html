<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Okinawa Journey | æ²–ç¹©äº”æ—¥éŠ (é›²ç«¯åŒæ­¥ç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;600;700&family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
      body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: #FEFCE8;
        color: #57534E;
        background-image: radial-gradient(#E5E0D8 1px, transparent 1px);
        background-size: 20px 20px;
        -webkit-tap-highlight-color: transparent;
      }
      h1, h2, h3, h4, .serif {
        font-family: 'Shippori Mincho', serif;
      }
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #D6D3D1; border-radius: 3px; }
      .hide-scrollbar::-webkit-scrollbar { display: none; }
      .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
      .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
      .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-[#FEFCE8] text-stone-800 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==========================================
        // 1. è¨­å®šæª” (å·²ä¿®æ­£èªæ³•ä¸¦å¡«å…¥æ‚¨çš„è³‡æ–™)
        // ==========================================
        const firebaseConfig = {
          apiKey: "AIzaSyCLAO8ebWjR-LVht4ogVJ8cWz_Sxxn8nm8",
          authDomain: "okinawa-test-80ac2.firebaseapp.com",
          databaseURL: "https://okinawa-test-80ac2-default-rtdb.firebaseio.com",
          projectId: "okinawa-test-80ac2",
          storageBucket: "okinawa-test-80ac2.firebasestorage.app",
          messagingSenderId: "29557355544",
          appId: "1:29557355544:web:bc489e0c59029b0fe63f6d",
          measurementId: "G-MB46NWT63H"
        };

        // ==========================================
        // 2. åˆå§‹åŒ– Firebase
        // ==========================================
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.database();
        } catch (error) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®šæª”", error);
            alert("è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Console");
        }

        // --- è¡Œç¨‹è³‡æ–™ ---
        const itineraryData = [
          {
            dateLabel: "1/10",
            dayOfWeek: "(å…­)",
            fullDate: "1/10 (é€±å…­) æŠµé”æ²–ç¹©",
            items: [
              { time: "08:10", mode: "é£›æ©Ÿ", title: "CI120 èµ·é£› (TPE -> OKA)", note: "10:40 æŠµé”æ²–ç¹©é‚£éœ¸æ©Ÿå ´", query: "é‚£éœ¸æ©Ÿå ´", travelTime: "é£›è¡Œç´„ 90åˆ†" },
              { time: "12:00", mode: "å…¬è»Š/è¨ˆç¨‹è»Š", title: "é£¯åº—å¯„æ”¾è¡Œæ / å‰å¾€å¸‚å€", note: "ä½å®¿ï¼šSeven Hotels Naha Miharanosatoã€‚å»ºè­°åˆ†å3å°è¨ˆç¨‹è»Šå…ˆæ”¾è¡Œæã€‚", query: "Seven Hotels Naha Miharanosato", link: "", travelTime: "ç´„ 20åˆ†" },
              { time: "13:00", mode: "æ­¥è¡Œ", title: "ç‰§å¿—å…¬è¨­å¸‚å ´ (åˆé¤)", note: "äº«ç”¨æµ·é®®ã€æ²–ç¹©æ–™ç†", query: "ç‰§å¿—å…¬è¨­å¸‚å ´", travelTime: "ç´„ 15åˆ†" },
              { time: "15:00", mode: "å–®è»Œ/è¨ˆç¨‹è»Š", title: "æ³¢ä¸Šå®® / æ³¢ä¹‹ä¸Šæµ·ç˜", note: "åƒæ‹œæ‡¸å´–ä¸Šçš„ç¥ç¤¾", query: "æ³¢ä¸Šå®®", travelTime: "ç´„ 15åˆ†" },
              { time: "17:00", mode: "å–®è»Œ/è¨ˆç¨‹è»Š", title: "é¦–é‡ŒåŸå…¬åœ’", note: "åƒè§€å¤–åœæˆ–æ¬£è³å¤•é™½", query: "é¦–é‡ŒåŸå…¬åœ’", travelTime: "ç´„ 30åˆ†" },
              { time: "19:30", mode: "æ­¥è¡Œ", title: "åœ‹éš›é€š (æ™šé¤/é€›è¡—)", note: "æ™šé¤å¾Œè¿”å›é£¯åº—", query: "åœ‹éš›é€š", travelTime: "ç´„ 20åˆ†" },
            ]
          },
          {
            dateLabel: "1/11",
            dayOfWeek: "(æ—¥)",
            fullDate: "1/11 (é€±æ—¥) å—éƒ¨è§€å…‰",
            items: [
              { time: "09:00", mode: "ç§Ÿè»Šè‡ªé§•", title: "ORIX å–è»Šï¼šæ—­æ©‹ç«™è¥¿åº—", note: "åœ°é»ï¼šORIX Asahibashi Station Westã€‚å»ºè­°æ­è¨ˆç¨‹è»Šå‰å¾€ï¼Œæ‰‹çºŒç´„ 1 å°æ™‚ã€‚", query: "ORIX Car Rental Asahibashi Station West", travelTime: "ç´„ 10åˆ†" },
              { time: "10:30", mode: "è‡ªé§•", title: "ç‰æ³‰æ´ / é˜ä¹³çŸ³", note: "æ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹", query: "æ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹ ç‰æ³‰æ´", travelTime: "ç´„ 30åˆ†" },
              { time: "13:00", mode: "è‡ªé§•", title: "ç€¨é•·å³¶ (å¹¸ç¦é¬†é¤…)", note: "åˆé¤/ä¸‹åˆèŒ¶ã€‚å‡æ—¥äººå¤šï¼Œå»ºè­°ä¸€åˆ°å…ˆæŠ½è™Ÿç¢¼ç‰Œã€‚", query: "ç€¨é•·å³¶ Umikaji Terrace", travelTime: "ç´„ 30åˆ†" },
              { time: "16:00", mode: "è‡ªé§•", title: "Aeon Mall Rycom", note: "å¯¶å¯å¤¢ä¸­å¿ƒã€Montbellã€è¶…å¸‚è£œè²¨", query: "Aeon Mall Okinawa Rycom", travelTime: "ç´„ 40åˆ†" },
            ]
          },
          {
            dateLabel: "1/12",
            dayOfWeek: "(ä¸€)",
            fullDate: "1/12 (é€±ä¸€) ä¸­éƒ¨ç©æ¨‚",
            items: [
              { time: "09:30", mode: "ç§Ÿè»Šè‡ªé§•", title: "æ°´ä¸Šæ´»å‹• or å¡ä¸è»Š", note: "åœ°é»ï¼šæ©ç´æ‘æˆ–åŒ—è°·å€åŸŸ", query: "æ©ç´æ‘", travelTime: "ç´„ 60åˆ†" },
              { time: "12:30", mode: "è‡ªé§•", title: "ç¾åœ‹æ‘ (American Village)", note: "åˆé¤ã€æ‹ç…§ã€æµ·æ¿±æ­¥é“", query: "ç¾åœ‹æ‘", travelTime: "ç´„ 30åˆ†" },
              { time: "17:30", mode: "ç§Ÿè»Šè‡ªé§•", title: "ORIX é‚„è»Šï¼šç¾æ¦®æ©‹ç«™åº—", note: "åœ°é»ï¼šORIX Miebashi Stationã€‚é‚„è»Šå‰è«‹è¨˜å¾—åŠ æ»¿æ²¹ã€‚", query: "ORIX Rent-a-car Miebashi Station", travelTime: "ç´„ 40åˆ†" },
              { time: "18:30", mode: "æ­¥è¡Œ", title: "å¸‚å€é€›è¡— / é£¯åº—ä¼‘æ¯", note: "ç¾æ¦®æ©‹ç«™é›¢åœ‹éš›é€šå¾ˆè¿‘ï¼Œé‚„è»Šå¾Œç§»å‹•æ–¹ä¾¿ã€‚", query: "ç¾æ¦®æ©‹ç«™", travelTime: "ç´„ 10åˆ†" },
              { time: "19:30", mode: "æ­¥è¡Œ", title: "æ™šé¤ï¼šç‡’è‚‰å·¥æˆ¿ åœ˜", note: "å¾ç¾æ¦®æ©‹ç«™æ­¥è¡Œå‰å¾€é¤å»³ç›¸å°ä¾¿åˆ©ã€‚", query: "ç‡’è‚‰å·¥æˆ¿ åœ˜ é‚£éœ¸", travelTime: "ç´„ 10åˆ†" },
            ]
          },
          {
            dateLabel: "1/13",
            dayOfWeek: "(äºŒ)",
            fullDate: "1/13 (é€±äºŒ) åŒ—éƒ¨ç¾éº—æµ·",
            items: [
              { time: "07:00", mode: "åŒ…è»Š", title: "å‡ºç™¼å¾€åŒ—éƒ¨", note: "9äººåŒ…è»Šä¸€æ—¥éŠã€‚ç‚ºç¢ºä¿ 08:30 æŠµé”æ°´æ—é¤¨ï¼Œè«‹æº–æ™‚å‡ºç™¼ã€‚", query: "é‚£éœ¸å¸‚", travelTime: "ç´„ 90åˆ†" },
              { time: "08:30", mode: "åŒ…è»Š", title: "ç¾éº—æµ·æ°´æ—é¤¨", note: "è©³è¦‹æ”»ç•¥ï¼Ocean Blue æŒ‡å®šå¸­ã€é»‘æ½®æ¢éšªã€æµ·è±šç§€ã€‚", query: "æ²–ç¹©ç¾éº—æµ·æ°´æ—é¤¨", travelTime: "æŠµé”", hasStrategy: true },
              { time: "12:00", mode: "æ­¥è¡Œ", title: "åˆé¤æ™‚é–“", note: "é¤è»Šæˆ–åœ’å€é¤å»³ï¼Œé †éŠæµ·é¾œé¤¨ã€æµ·ç‰›é¤¨ã€‚", query: "ç¾éº—æµ·æ°´æ—é¤¨", travelTime: "åœ’å€å…§" },
              { time: "13:00", mode: "æ­¥è¡Œ", title: "é¤¨å…§åƒè§€ / é¤µé£Ÿç§€", note: "ç†±å¸¶é­šé¤µé£Ÿç§€ (13:00/15:30)ã€æ·±æµ·å€ã€‚", query: "ç¾éº—æµ·æ°´æ—é¤¨", travelTime: "åœ’å€å…§" },
              { time: "16:00", mode: "åŒ…è»Š", title: "å¤å®‡åˆ©å³¶ / è¦è¦é£¯", note: "æ¬£è³å¤å®‡åˆ©å¤§æ©‹ç¾æ™¯ã€äº«ç”¨æ—©æ™šé¤ã€‚", query: "å¤å®‡åˆ©å³¶", travelTime: "ç´„ 30åˆ†" },
              { time: "18:00", mode: "åŒ…è»Š", title: "è¿”å›é‚£éœ¸å¸‚å€", note: "åŒ…è»ŠçµæŸ", query: "é‚£éœ¸å¸‚", travelTime: "ç´„ 90åˆ†" },
              { time: "19:30", mode: "æ­¥è¡Œ", title: "æ™šé¤ï¼šé³¥è²´æ— (Torikizoku)", note: "ç¾æ¦®æ©‹åº— æˆ– æ¾å±±åº—ã€‚9äººå»ºè­°åˆ†æ‹† 2-3 æ¡Œã€‚", query: "é³¥è²´æ— æ²–ç¹©", travelTime: "ç´„ 15åˆ†" },
            ]
          },
          {
            dateLabel: "1/14",
            dayOfWeek: "(ä¸‰)",
            fullDate: "1/14 (é€±ä¸‰) è³é¯¨èˆ‡è¿”ç¨‹",
            items: [
              { time: "07:20", mode: "å…¬å…±äº¤é€š", title: "é€€æˆ¿ & è¡Œæå¯„æ”¾", note: "âš ï¸ è³é¯¨èˆ¹ç¦å¸¶è¡Œæç®±ã€‚è«‹å°‡è¡Œæå¸¶è‡³ ç‰§å¿—ç«™ æˆ– Saion Square ç½®ç‰©æ«ƒã€‚", query: "Saion Square Okinawa", travelTime: "ç´„ 15åˆ†" },
              { time: "07:55", mode: "æ­¥è¡Œ", title: "è³é¯¨é›†åˆ", note: "Family Mart (Saion Square) é›†åˆã€‚è«‹æº–æ™‚æŠµé”ã€‚", query: "Family Mart Saion Square", travelTime: "ç´„ 10åˆ†" },
              { time: "08:30", mode: "èˆ¹é‹", title: "å‡ºæµ·è³é¯¨", note: "äº«å—å‡ºæµ·æ¨‚è¶£", query: "é‚£éœ¸ æ³Šæ¸¯", travelTime: "ç´„ 15åˆ†" },
              { time: "12:30", mode: "æ­¥è¡Œ", title: "å…¨å“¡æœƒåˆ / åˆé¤", note: "è³é¯¨çµæŸï¼Œå…¨å“¡é›†åˆç”¨é¤", query: "Saion Square", travelTime: "ç´„ 10åˆ†" },
              { time: "14:00", mode: "å–®è»Œ", title: "æœ€å¾Œè£œè²¨ / æ©Ÿå ´ç§»å‹•", note: "æ‹¿å–å¯„æ”¾è¡Œæï¼Œå‰å¾€æ©Ÿå ´", query: "é‚£éœ¸æ©Ÿå ´", travelTime: "ç´„ 30åˆ†" },
              { time: "~20:50", mode: "é£›æ©Ÿ", title: "CI123 è¿”å°", note: "æ»¿è¼‰è€Œæ­¸", query: "é‚£éœ¸æ©Ÿå ´", travelTime: "ç´„ 20åˆ†" },
            ]
          },
        ];

        // --- Mock Services ---
        const mockGenerateItinerary = async (pref) => {
            return new Promise((resolve) => {
                setTimeout(() => resolve(`
**é€™æ˜¯ä¸€å€‹æ¨¡æ“¬å›æ‡‰ (Mock Response)**

æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œå»ºè­°æ‚¨å¯ä»¥å‰å¾€ï¼š
1. **åœ‹éš›é€š (Kokusai Dori)**: å¿…å»çš„è³¼ç‰©è¡—ã€‚
2. **ç¾åœ‹æ‘ (American Village)**: å……æ»¿ç•°åœ‹é¢¨æƒ…ã€‚

(ç”±æ–¼æ­¤ç‚ºéœæ…‹é è¦½ç‰ˆï¼ŒAI åŠŸèƒ½åƒ…ç‚ºå±•ç¤ºã€‚)
                `), 1500);
            });
        };

        const mockGenerateImage = async (prompt) => {
            return new Promise((resolve) => {
                setTimeout(() => resolve("https://image.pollinations.ai/prompt/cute%20okinawa%20watercolor?width=800&height=600"), 1500);
            });
        };

        // --- Components ---

        const BackgroundDecorations = () => {
          return (
            <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden opacity-50">
              <svg className="absolute -right-8 top-10 w-40 h-40 text-rose-300 transform rotate-12" viewBox="0 0 100 100" fill="currentColor">
                <path d="M50 50 Q70 20 90 40 Q80 70 50 60 Q20 70 10 40 Q30 20 50 50 Z" opacity="0.6"/>
                <circle cx="50" cy="50" r="10" fill="#F43F5E"/>
                <path d="M50 50 L50 20 M50 50 L80 50 M50 50 L50 80 M50 50 L20 50" stroke="#F43F5E" strokeWidth="2"/>
              </svg>
              <svg className="absolute -left-10 top-1/3 w-64 h-64 text-blue-200 transform -rotate-12" viewBox="0 0 200 100" fill="currentColor">
                <path d="M20 50 Q60 20 120 40 Q160 50 180 40 L190 50 L180 60 Q160 50 120 60 Q60 80 20 50 Z" />
                <circle cx="40" cy="45" r="3" fill="#FFF"/>
                <circle cx="150" cy="50" r="2" fill="#FFF"/>
                <circle cx="130" cy="45" r="2" fill="#FFF"/>
                <circle cx="110" cy="55" r="2" fill="#FFF"/>
              </svg>
              <svg className="absolute -right-4 bottom-24 w-32 h-32 text-orange-200" viewBox="0 0 100 100" fill="currentColor">
                <path d="M20 80 L80 80 L90 60 Q95 40 70 30 Q50 20 30 30 Q5 40 10 60 Z" />
                <circle cx="35" cy="50" r="5" fill="#FFF"/>
                <circle cx="65" cy="50" r="5" fill="#FFF"/>
                <path d="M35 60 Q50 70 65 60" stroke="#FFF" strokeWidth="3" fill="none"/>
              </svg>
              <svg className="absolute bottom-0 left-0 w-full h-20 text-teal-100/50" preserveAspectRatio="none" viewBox="0 0 1200 120">
                 <path d="M0,0 C150,60 350,0 600,40 C850,80 1050,20 1200,60 L1200,120 L0,120 Z" fill="currentColor"/>
              </svg>
            </div>
          );
        };

        const StickerIcon = ({ mode }) => {
          let content;
          let bgClass = "bg-white"; 
          let borderClass = "border-2 border-stone-200";

          if (mode.includes("é£›æ©Ÿ")) {
            content = <span className="text-2xl drop-shadow-sm">âœˆï¸</span>;
            bgClass = "bg-sky-100";
            borderClass = "border-2 border-white ring-2 ring-sky-200";
          } else if (mode.includes("è‡ªé§•") || mode.includes("ç§Ÿè»Š") || mode.includes("åŒ…è»Š")) {
            content = <span className="text-2xl drop-shadow-sm">ğŸš—</span>;
            bgClass = "bg-orange-100";
            borderClass = "border-2 border-white ring-2 ring-orange-200";
          } else if (mode.includes("è¨ˆç¨‹è»Š")) {
            content = <span className="text-2xl drop-shadow-sm">ğŸš•</span>;
            bgClass = "bg-yellow-100";
            borderClass = "border-2 border-white ring-2 ring-yellow-200";
          } else if (mode.includes("å–®è»Œ") || mode.includes("å…¬è»Š") || mode.includes("å…¬å…±")) {
            content = <span className="text-2xl drop-shadow-sm">ğŸš</span>;
            bgClass = "bg-indigo-100";
            borderClass = "border-2 border-white ring-2 ring-indigo-200";
          } else if (mode.includes("èˆ¹")) {
            content = <span className="text-2xl drop-shadow-sm">ğŸ›¥ï¸</span>;
            bgClass = "bg-blue-100";
            borderClass = "border-2 border-white ring-2 ring-blue-200";
          } else {
            content = <span className="text-2xl drop-shadow-sm">ğŸ‘£</span>;
            bgClass = "bg-emerald-100";
            borderClass = "border-2 border-white ring-2 ring-emerald-200";
          }

          return (
            <div className={`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transform -rotate-6 hover:rotate-6 transition-transform ${bgClass} ${borderClass}`}>
              {content}
            </div>
          );
        };

        const ChuraumiModal = ({ isOpen, onClose }) => {
          if (!isOpen) return null;

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 modal-backdrop animate-fade-in">
              <div className="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto shadow-2xl relative border-4 border-blue-200">
                <button 
                  onClick={onClose}
                  className="absolute top-3 right-3 bg-stone-100 hover:bg-stone-200 text-stone-500 rounded-full p-2 transition-colors z-10"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                
                <div className="bg-blue-500 p-6 text-white text-center relative overflow-hidden">
                   <div className="absolute top-0 left-0 w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                   <h2 className="text-2xl font-bold serif relative z-10">ç¾éº—æµ·æœ€å¼·æ”»ç•¥</h2>
                   <p className="text-blue-100 text-sm mt-1 relative z-10">Ocean Blue æŒ‡å®šå¸­ + é»‘æ½®æ¢éšª</p>
                </div>

                <div className="p-6 space-y-6">
                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">09:00</div>
                      <div>
                         <h4 className="font-bold text-stone-800">æŠµé” & è¡åˆº</h4>
                         <p className="text-sm text-stone-600">å…¥å ´å¾Œç›´å¥” <span className="text-blue-600 font-bold">Ocean Blue å’–å•¡å»³</span> æ«ƒå°é ç´„æŒ‡å®šå¸­ã€‚</p>
                      </div>
                   </div>

                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">09:10</div>
                      <div>
                         <h4 className="font-bold text-stone-800">å…¥åº§å’–å•¡å»³</h4>
                         <p className="text-sm text-stone-600">æŒ‡å®šå¸­è²»ç”¨ Â¥1000 + ä½æ¶ˆã€‚ä½¿ç”¨æ™‚é–“ç´„ 40 åˆ†é˜ã€‚é›¶è·é›¢æ¬£è³é»‘æ½®ä¹‹æµ·ã€‚</p>
                      </div>
                   </div>

                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">09:30</div>
                      <div>
                         <h4 className="font-bold text-stone-800">é¬¼è é­Ÿé¤µé£Ÿç§€</h4>
                         <p className="text-sm text-stone-600">ä¸€é‚Šå–å’–å•¡ä¸€é‚Šæ¬£è³å„ªé›…çš„é¬¼è é­Ÿé€²é£Ÿã€‚</p>
                      </div>
                   </div>

                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">10:00</div>
                      <div>
                         <h4 className="font-bold text-stone-800">é»‘æ½®æ¢éšª</h4>
                         <p className="text-sm text-stone-600">é›¢é–‹å’–å•¡å»³ï¼Œå‰å¾€é¯¨é¯Šå±•å€æ—å°ˆç”¨é›»æ¢¯ã€‚å¾æ­£ä¸Šæ–¹ä¿¯ç°å¤§æ°´æ§½ (è‡³ 10:45 çµæŸ)ã€‚</p>
                      </div>
                   </div>

                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">11:30</div>
                      <div>
                         <h4 className="font-bold text-stone-800">æµ·è±šè¡¨æ¼”</h4>
                         <p className="text-sm text-stone-600">æˆ¶å¤–åŠ‡å ´ã€‚é›¢é¤¨å‰å‹™å¿…è“‹æ‰‹ç« ï¼Œä¸‹åˆå¯å†æ¬¡å…¥é¤¨ã€‚</p>
                      </div>
                   </div>

                   <div className="flex gap-4 items-start">
                      <div className="w-12 text-center font-bold text-blue-600 shrink-0">15:00</div>
                      <div>
                         <h4 className="font-bold text-stone-800">é¯¨é¯Šé¤µé£Ÿç§€</h4>
                         <p className="text-sm text-stone-600">æœ€éœ‡æ’¼é‡é ­æˆ²ï¼å»ºè­°14:50å›é»‘æ½®ä¹‹æµ·å¡ä½ï¼Œæˆ–ç«™é«˜è™•æ‹ã€Œå‚ç›´é€²é£Ÿã€ã€‚</p>
                      </div>
                   </div>

                   <div className="bg-yellow-50 border border-yellow-200 p-4 rounded-xl text-sm text-stone-700">
                      <span className="font-bold">ğŸ’¡ å°è²¼å£«ï¼š</span> ä¾ç…§æ­¤è·¯ç·šå¯ä¸€æ¬¡æ»¿è¶³æŒ‡å®šå¸­ã€æ¢éšªã€é¤µé£Ÿç§€ï¼Œæœ€é †æš¢ï¼
                   </div>
                </div>

                <div className="p-4 border-t border-stone-100 text-center">
                   <button onClick={onClose} className="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-blue-700 active:scale-95 transition-all">
                      æˆ‘çŸ¥é“äº†ï¼
                   </button>
                </div>
              </div>
            </div>
          );
        };

        const ExpenseTracker = () => {
          const [members, setMembers] = useState(["é˜¿è³¢", "å°å±•", "çç", "é˜¿å¨Ÿ", "ç¾½å­", "å–¬å­", "å¼·ç¾…", "è³½ä¼¯", "é˜¿å³°"]);
          
          const [expenses, setExpenses] = useState([]);
          const [showAddForm, setShowAddForm] = useState(false);
          const [editingId, setEditingId] = useState(null);

          const [payer, setPayer] = useState(members[0]);
          const [description, setDescription] = useState("");
          const [amount, setAmount] = useState("");

          // --- é›²ç«¯åŒæ­¥æ ¸å¿ƒé‚è¼¯ ---
          useEffect(() => {
            if (!db) return; // å¦‚æœæ²’æœ‰åˆå§‹åŒ–è³‡æ–™åº«ï¼Œå°±ä¸åŸ·è¡Œ

            const expensesRef = db.ref('expenses');
            
            const handleData = (snapshot) => {
              const data = snapshot.val();
              if (data) {
                const loadedExpenses = Object.entries(data).map(([key, value]) => ({
                  id: key, 
                  ...value
                })).sort((a, b) => b.timestamp - a.timestamp);
                setExpenses(loadedExpenses);
              } else {
                setExpenses([]);
              }
            };

            expensesRef.on('value', handleData);

            return () => {
              expensesRef.off('value', handleData);
            };
          }, []);

          const handleSaveExpense = () => {
            if (!description || !amount) return;
            if (!db) { alert("è«‹å…ˆè¨­å®š Firebase Config æ‰èƒ½å„²å­˜ï¼"); return; }

            if (editingId) {
              // æ›´æ–°
              db.ref('expenses/' + editingId).update({
                payer,
                description,
                amount: parseFloat(amount)
              }).catch(err => alert("æ›´æ–°å¤±æ•—: " + err.message));
            } else {
              // æ–°å¢
              const newRef = db.ref('expenses').push();
              newRef.set({
                payer,
                description,
                amount: parseFloat(amount),
                date: new Date().toLocaleDateString(),
                timestamp: firebase.database.ServerValue.TIMESTAMP
              }).catch(err => alert("æ–°å¢å¤±æ•—: " + err.message));
            }
            
            resetForm();
          };

          const handleEdit = (expense) => {
            setEditingId(expense.id);
            setPayer(expense.payer);
            setDescription(expense.description);
            setAmount(expense.amount.toString());
            setShowAddForm(true);
          };

          const handleDelete = (id) => {
            if (!db) return;
            if (window.confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")) {
              db.ref('expenses/' + id).remove().catch(err => alert("åˆªé™¤å¤±æ•—: " + err.message));
              
              if (editingId === id) {
                resetForm();
              }
            }
          };

          const resetForm = () => {
            setDescription("");
            setAmount("");
            setEditingId(null);
            setShowAddForm(false);
            setPayer(members[0]);
          };

          const totalSpent = expenses.reduce((acc, curr) => acc + curr.amount, 0);
          const avgPerPerson = expenses.length > 0 ? totalSpent / members.length : 0;

          const calculateSettlement = () => {
            if (expenses.length === 0) return [];

            let balances = {};
            members.forEach(m => balances[m] = 0);

            expenses.forEach(e => {
              balances[e.payer] += e.amount;
            });
            members.forEach(m => {
              balances[m] -= avgPerPerson;
            });

            const debtors = [];
            const creditors = [];

            Object.entries(balances).forEach(([name, val]) => {
              if (val < -0.01) debtors.push({ name, amount: val });
              if (val > 0.01) creditors.push({ name, amount: val });
            });

            debtors.sort((a, b) => a.amount - b.amount);
            creditors.sort((a, b) => b.amount - a.amount);

            const result = [];
            let i = 0; 
            let j = 0; 

            while (i < debtors.length && j < creditors.length) {
              let debtor = debtors[i];
              let creditor = creditors[j];
              
              let amt = Math.min(Math.abs(debtor.amount), creditor.amount);
              
              result.push({ from: debtor.name, to: creditor.name, amount: amt });
              
              debtor.amount += amt;
              creditor.amount -= amt;

              if (Math.abs(debtor.amount) < 0.01) i++;
              if (creditor.amount < 0.01) j++;
            }

            return result;
          };

          const settlement = calculateSettlement();

          return (
             <div className="px-5 pb-24 pt-6 min-h-screen relative z-10">
               {/* ç¸½é–‹éŠ·é¡¯ç¤º */}
               <div className="bg-[#FFFBEB]/90 backdrop-blur border-2 border-[#78716C] rounded-2xl p-5 mb-6 shadow-[4px_4px_0px_0px_rgba(120,113,108,1)] relative overflow-hidden">
                <div className="relative z-10">
                  <h2 className="text-sm font-bold text-stone-500 uppercase tracking-widest mb-1">ç¸½é–‹éŠ· Total</h2>
                  <div className="flex items-baseline gap-2">
                    <span className="text-3xl font-black text-stone-800 tracking-tighter">Â¥{totalSpent.toLocaleString()}</span>
                    <span className="text-xs text-stone-500">({members.length}äººå‡åˆ† Â¥{Math.round(avgPerPerson).toLocaleString()})</span>
                  </div>
                </div>
                <div className="absolute right-[-20px] top-[-20px] w-24 h-24 bg-yellow-200 rounded-full opacity-50 blur-xl"></div>
              </div>

              {!showAddForm && (
                <button 
                  onClick={() => { resetForm(); setShowAddForm(true); }}
                  className="w-full py-3 bg-[#4E342E] text-[#FEFCE8] rounded-xl font-bold shadow-lg active:scale-95 transition-all mb-8 flex items-center justify-center gap-2 border-2 border-transparent hover:bg-[#3E2723]"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>
                  è¨˜ä¸€ç­† (åŒæ­¥ä¸­)
                </button>
              )}

              {showAddForm && (
                <div className="bg-white/90 backdrop-blur border-2 border-stone-200 rounded-xl p-4 mb-8 shadow-sm animate-fade-in">
                  <h3 className="text-sm font-bold text-stone-800 mb-3 flex items-center gap-2">
                    <span className="w-2 h-2 bg-yellow-400 rounded-full"></span> 
                    {editingId ? "ç·¨è¼¯æ”¯å‡º" : "æ–°å¢æ”¯å‡º"}
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <label className="text-xs text-stone-500 block mb-1">èª°ä»˜çš„éŒ¢?</label>
                      <select 
                        value={payer} 
                        onChange={(e) => setPayer(e.target.value)}
                        className="w-full bg-[#FAFAF9] border border-stone-300 rounded-lg px-3 py-2 text-sm outline-none focus:border-stone-800"
                      >
                        {members.map(m => <option key={m} value={m}>{m}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="text-xs text-stone-500 block mb-1">ä»˜äº†ä»€éº¼?</label>
                      <input 
                        type="text" 
                        value={description}
                        onChange={(e) => setDescription(e.target.value)}
                        placeholder="ä¾‹å¦‚: åˆé¤, é–€ç¥¨..."
                        className="w-full bg-[#FAFAF9] border border-stone-300 rounded-lg px-3 py-2 text-sm outline-none focus:border-stone-800"
                      />
                    </div>
                    <div>
                      <label className="text-xs text-stone-500 block mb-1">å¤šå°‘éŒ¢ (æ—¥å¹£)?</label>
                      <input 
                        type="number" 
                        value={amount}
                        onChange={(e) => setAmount(e.target.value)}
                        placeholder="0"
                        className="w-full bg-[#FAFAF9] border border-stone-300 rounded-lg px-3 py-2 text-sm outline-none focus:border-stone-800"
                      />
                    </div>
                    <div className="flex gap-2 pt-2">
                      <button onClick={resetForm} className="flex-1 py-2 text-stone-500 text-sm font-medium hover:bg-stone-100 rounded-lg">å–æ¶ˆ</button>
                      <button onClick={handleSaveExpense} className="flex-1 py-2 bg-yellow-400 text-stone-900 text-sm font-bold rounded-lg shadow-sm hover:bg-yellow-500">
                        {editingId ? "æ›´æ–°" : "ç¢ºå®š"}
                      </button>
                    </div>
                  </div>
                </div>
              )}

              <div className="space-y-6">
                <div>
                  <h3 className="serif text-lg font-bold text-[#4E342E] mb-3 border-b-2 border-yellow-200 inline-block">æ¶ˆè²»ç´€éŒ„</h3>
                  {expenses.length === 0 ? (
                    <div className="text-center py-8 text-stone-400 text-sm bg-white/50 rounded-xl border border-dashed border-stone-300">
                      ç›®å‰æ²’æœ‰ç´€éŒ„ (æˆ–æ­£åœ¨åŒæ­¥ä¸­...)
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {expenses.map(e => (
                        <div key={e.id} className="bg-white/90 backdrop-blur rounded-xl p-3 border border-stone-200 flex justify-between items-center shadow-sm group">
                          <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-xs font-bold text-stone-600 border border-stone-200">
                              {e.payer.charAt(0)}
                            </div>
                            <div>
                              <p className="font-bold text-stone-800 text-sm">{e.description}</p>
                              <p className="text-xs text-stone-500">{e.payer} ä»˜æ¬¾</p>
                            </div>
                          </div>
                          
                          <div className="flex items-center gap-4">
                            <span className="font-mono font-bold text-stone-800">Â¥{e.amount.toLocaleString()}</span>
                            <div className="flex gap-2 opacity-50 group-hover:opacity-100 transition-opacity">
                              <button 
                                onClick={() => handleEdit(e)}
                                className="p-1.5 text-stone-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                              </button>
                              <button 
                                onClick={() => handleDelete(e.id)}
                                className="p-1.5 text-stone-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                {settlement.length > 0 && (
                  <div className="pt-4">
                    <h3 className="serif text-lg font-bold text-stone-700 mb-3 border-b-2 border-teal-200 inline-block">çµç®—å»ºè­°</h3>
                    <div className="bg-white/90 backdrop-blur rounded-xl border border-stone-200 overflow-hidden">
                      {settlement.map((s, idx) => (
                        <div key={idx} className={`p-4 flex items-center justify-between ${idx !== settlement.length - 1 ? 'border-b border-stone-100' : ''}`}>
                          <div className="flex items-center gap-2 text-sm">
                            <span className="font-bold text-red-500">{s.from}</span>
                            <span className="text-stone-400">â”</span>
                            <span className="font-bold text-green-600">{s.to}</span>
                          </div>
                          <span className="font-mono font-bold text-stone-800">Â¥{Math.round(s.amount).toLocaleString()}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
             </div>
          );
        };

        const App = () => {
          const [activeTab, setActiveTab] = useState('schedule');
          const [selectedDay, setSelectedDay] = useState(0);
          
          const [question, setQuestion] = useState("");
          const [answer, setAnswer] = useState("");
          const [aiLoading, setAiLoading] = useState(false);
          
          const [headerImage, setHeaderImage] = useState("https://image.pollinations.ai/prompt/beautiful%20okinawa%20beach%20turquoise%20ocean%20cinematic%20lighting?width=1080&height=600&nologo=true");
          const [isGeneratingCover, setIsGeneratingCover] = useState(false);
          const [showChuraumiModal, setShowChuraumiModal] = useState(false);

          const handleAskAI = async () => {
            if (!question.trim()) return;
            setAiLoading(true);
            setAnswer("");

            try {
              const text = await mockGenerateItinerary(question);
              setAnswer(text);
            } catch (e) {
              setAnswer("æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•å›ç­”æ‚¨çš„å•é¡Œã€‚");
            } finally {
              setAiLoading(false);
            }
          };

          const handleGenerateCover = async () => {
            setIsGeneratingCover(true);
            try {
              const image = await mockGenerateImage("okinawa");
              setHeaderImage(image);
            } catch (error) {
              console.error("Failed to generate cover", error);
              alert("ç„¡æ³•ç”Ÿæˆåœ–ç‰‡");
            } finally {
              setIsGeneratingCover(false);
            }
          };

          return (
            <div className="max-w-md mx-auto shadow-2xl overflow-hidden relative border-x-2 border-[#E7E5E4] min-h-screen flex flex-col bg-[#FEFCE8]">
              
              <BackgroundDecorations />
              
              <ChuraumiModal isOpen={showChuraumiModal} onClose={() => setShowChuraumiModal(false)} />

              <div className="fixed bottom-0 left-0 right-0 z-50 bg-[#FEFCE8]/95 backdrop-blur border-t-2 border-[#78716C] flex justify-around pb-safe max-w-md mx-auto">
                <button 
                  onClick={() => setActiveTab('schedule')}
                  className={`flex-1 py-3 flex flex-col items-center gap-1 transition-colors ${activeTab === 'schedule' ? 'text-stone-800' : 'text-stone-400'}`}
                >
                  <svg className={`w-6 h-6 ${activeTab === 'schedule' ? 'fill-yellow-400 stroke-stone-800' : 'stroke-current fill-none'}`} strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                  <span className="text-[10px] font-bold">è¡Œç¨‹è¡¨</span>
                </button>
                <button 
                  onClick={() => setActiveTab('wallet')}
                  className={`flex-1 py-3 flex flex-col items-center gap-1 transition-colors ${activeTab === 'wallet' ? 'text-stone-800' : 'text-stone-400'}`}
                >
                  <svg className={`w-6 h-6 ${activeTab === 'wallet' ? 'fill-yellow-400 stroke-stone-800' : 'stroke-current fill-none'}`} strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                  <span className="text-[10px] font-bold">å…¬è²»åˆ†æ“”</span>
                </button>
              </div>

              {activeTab === 'wallet' ? (
                <ExpenseTracker />
              ) : (
                <div className="pb-20 relative z-10">
                  <div className="relative h-44 bg-stone-300 overflow-hidden rounded-b-[2rem] shadow-lg mb-2 group">
                    <img 
                      src={headerImage} 
                      alt="Okinawa Header" 
                      className={`w-full h-full object-cover opacity-90 transition-opacity duration-700 ${isGeneratingCover ? 'opacity-50 blur-sm' : ''}`}
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-stone-900/40 via-transparent to-transparent"></div>
                    
                    <button 
                      onClick={handleGenerateCover}
                      disabled={isGeneratingCover}
                      className="absolute top-3 right-3 bg-white/30 backdrop-blur hover:bg-white/50 text-white p-2 rounded-full border border-white/50 shadow-sm transition-all active:scale-95"
                      title="ç”Ÿæˆ AI æ‰‹ç¹ªå°é¢"
                    >
                      {isGeneratingCover ? (
                        <svg className="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                      ) : (
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
                      )}
                    </button>

                    <div className="absolute bottom-4 left-6 text-white drop-shadow-md">
                      <h1 className="text-4xl font-bold serif tracking-wide">æ²–ç¹©äº”æ—¥</h1>
                      <div className="flex items-center gap-2 mt-1">
                          <span className="text-yellow-300 text-lg">â˜…</span>
                          <span className="text-sm font-medium tracking-wider">å®¶æ—ã®æ—…</span>
                      </div>
                    </div>
                  </div>

                  <div className="sticky top-0 z-20 pt-2 pb-2">
                    <div className="flex overflow-x-auto hide-scrollbar px-4 gap-3 snap-x">
                      {itineraryData.map((day, index) => (
                        <button
                          key={index}
                          onClick={() => setSelectedDay(index)}
                          className={`flex-shrink-0 snap-start flex flex-col items-center justify-center w-16 h-20 py-2 rounded-2xl border-2 transition-all duration-300 ${
                            selectedDay === index 
                            ? 'bg-yellow-400 text-stone-900 border-white shadow-lg -translate-y-1 scale-105' 
                            : 'bg-white/80 text-stone-500 border-white shadow-sm hover:bg-white'
                          }`}
                        >
                          <span className="text-sm font-black">{day.dateLabel}</span>
                          <span className="text-xs font-medium mb-1">{day.dayOfWeek}</span>
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="px-4 py-4">
                    <div className="mb-6 flex items-center justify-between bg-white/60 backdrop-blur rounded-full px-4 py-2 border border-white shadow-sm">
                      <h2 className="text-lg font-bold text-stone-700 serif">
                        {itineraryData[selectedDay].fullDate}
                      </h2>
                    </div>

                    <div className="space-y-6 relative">
                      <div className="absolute left-[27px] top-6 bottom-6 w-0.5 border-l-2 border-dashed border-stone-300/60 z-0"></div>

                      {itineraryData[selectedDay].items.map((item, idx) => (
                        <div key={idx} className="relative z-10 flex gap-4 group">
                           {item.travelTime && idx > 0 && (
                              <div className="absolute left-[16px] -top-5 z-20">
                                 <span className="text-[10px] font-bold text-stone-400 bg-[#FEFCE8] px-1.5 py-0.5 rounded border border-stone-200/50 whitespace-nowrap shadow-sm">
                                   â¬‡ {item.travelTime}
                                 </span>
                              </div>
                           )}

                          <div className="flex-shrink-0 pt-1">
                             <StickerIcon mode={item.mode} />
                          </div>

                          <div className="flex-grow flex flex-col gap-2">
                            <a 
                                href={item.link ? item.link : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.query + " æ²–ç¹©")}`}
                                target="_blank"
                                rel="noreferrer"
                                className="bg-white/90 backdrop-blur rounded-2xl p-4 border-2 border-white shadow-md active:scale-[0.98] transition-all relative overflow-hidden group-hover:border-yellow-200 group-hover:shadow-lg block"
                            >
                                <div className="flex justify-between items-start mb-2">
                                <span className="text-xs font-black text-stone-600 bg-yellow-100 px-2 py-0.5 rounded-md tracking-wide shadow-sm">{item.time}</span>
                                <span className="text-[10px] text-stone-400 font-bold uppercase tracking-wider">{item.mode}</span>
                                </div>
                                <h3 className="text-base font-bold text-stone-800 mb-1 leading-tight group-hover:text-amber-700 transition-colors flex items-center gap-1">
                                {item.title}
                                </h3>
                                <p className="text-sm text-stone-500 leading-relaxed font-normal">{item.note}</p>
                            </a>
                            
                            {item.hasStrategy && (
                                <button 
                                    onClick={() => setShowChuraumiModal(true)}
                                    className="bg-blue-600 text-white text-sm font-bold py-2 px-4 rounded-xl shadow-lg flex items-center justify-center gap-2 animate-pulse hover:animate-none hover:bg-blue-700 transition-colors"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                    æŸ¥çœ‹ç¾éº—æµ·æœ€å¼·æ”»ç•¥
                                </button>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="px-5 py-8 mt-4">
                      <div className="bg-[#FFFBEB]/90 backdrop-blur rounded-3xl p-5 border-2 border-[#E7E5E4] shadow-lg relative overflow-hidden">
                        <div className="absolute -right-4 -top-4 w-16 h-16 bg-yellow-200 rounded-full opacity-50"></div>

                        <h3 className="serif text-lg font-bold text-stone-700 mb-4 flex items-center gap-2 relative z-10">
                          <span className="bg-stone-800 text-white rounded-lg p-1">
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
                          </span>
                          æ²–ç¹©å°å¹«æ‰‹
                        </h3>
                        
                        <div className="bg-white/80 rounded-2xl p-4 border border-stone-100 shadow-inner mb-4 relative z-10">
                          {answer ? (
                            <div className="prose prose-stone prose-sm max-w-none mb-4" dangerouslySetInnerHTML={{ __html: marked.parse(answer) }} />
                          ) : (
                            <div className="flex gap-2">
                              <input 
                                type="text" 
                                value={question}
                                onChange={(e) => setQuestion(e.target.value)}
                                placeholder="å•å•å¤©æ°£ã€æ¨è–¦ä¼´æ‰‹ç¦®..."
                                className="flex-grow bg-[#FAFAF9] border border-stone-300 rounded-xl px-3 py-2 text-sm focus:border-stone-800 outline-none transition-colors"
                                onKeyDown={(e) => e.key === 'Enter' && handleAskAI()}
                              />
                              <button 
                                onClick={handleAskAI}
                                disabled={aiLoading}
                                className="bg-yellow-400 hover:bg-yellow-500 text-stone-900 px-4 py-2 rounded-xl text-lg font-bold shadow-sm disabled:opacity-50 transition-colors"
                              >
                                {aiLoading ? '...' : 'Go'}
                              </button>
                            </div>
                          )}
                          {answer && (
                              <button onClick={() => { setAnswer(""); setQuestion(""); }} className="text-xs text-amber-600 font-bold underline mt-3 block text-right">å•å…¶ä»–å•é¡Œ</button>
                          )}
                        </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
